<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆé¤åƒä»€éº¼æ±ºå®šå™¨</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¨­å®š Inter å­—é«”å’Œæ·±è‰²æ¨¡å¼æ¨£å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* æ·±è—è‰²èƒŒæ™¯ */
            color: #e0e0e0; /* æ·ºç°è‰²æ–‡å­— */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* è½‰ç›¤å®¹å™¨ - è®“æŒ‡æ¨™å¯ä»¥å®šä½åœ¨ä¸­å¤®ä¸Šæ–¹ */
        .wheel-container {
            position: relative;
            display: inline-block;
            margin: 0 auto;
        }

        /* è½‰ç›¤æŒ‡é‡ */
        .pointer {
            position: absolute;
            top: 0; /* å®šä½åœ¨è½‰ç›¤ä¸Šæ–¹ */
            left: 50%;
            transform: translate(-50%, -100%) translateY(10px); /* å‘ä¸Šç§»å‹•ä¸¦å¾®èª¿ä½ç½® */
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 30px solid #f97316; /* æ©˜è‰²æŒ‡é‡ */
            z-index: 10;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        /* è½‰ç›¤å‹•ç•«å®¹å™¨ */
        #roulette-wheel {
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1); /* å¹³æ»‘çš„åŠ é€Ÿå’Œæ¸›é€Ÿ */
        }
    </style>
</head>
<body class="dark">

    <div class="p-4 md:p-8 w-full max-w-4xl">
        <h1 class="text-4xl md:text-5xl font-extrabold text-center mb-10 text-teal-400">
            ğŸ´ åˆé¤å‘½é‹è½‰ç›¤ ğŸ²
        </h1>

        <!-- ä¸»è¦ä½ˆå±€ï¼šè½‰ç›¤èˆ‡æ§åˆ¶é … (åœ¨æ‰‹æ©Ÿä¸Šå †ç–Šï¼Œæ¡Œé¢ä¸Šå·¦å³ä¸¦æ’) -->
        <div class="flex flex-col md:flex-row gap-10">

            <!-- å·¦å´ï¼šè½‰ç›¤é¡¯ç¤ºå€ -->
            <div class="md:w-1/2 flex justify-center items-center">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="roulette-wheel" width="400" height="400" class="rounded-full bg-gray-800 shadow-2xl border-4 border-teal-500"></canvas>
                </div>
            </div>

            <!-- å³å´ï¼šæ§åˆ¶é¢æ¿èˆ‡çµæœ -->
            <div class="md:w-1/2 space-y-8">
                
                <!-- çµæœé¡¯ç¤ºå€ -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-xl border border-gray-700">
                    <h2 class="text-2xl font-bold mb-3 text-white">ä»Šæ—¥æ±ºå®šï¼š</h2>
                    <p id="result-display" class="text-3xl font-extrabold text-orange-400">é»æ“Šã€Œé–‹å§‹æ—‹è½‰ã€</p>
                    <div id="message-box" class="mt-4 p-3 bg-red-800 text-red-200 rounded-lg hidden"></div>
                </div>

                <!-- æ—‹è½‰æŒ‰éˆ• -->
                <button id="spin-button" class="w-full py-4 text-xl font-bold rounded-lg shadow-xl bg-teal-500 text-gray-900 hover:bg-teal-400 transition duration-300 transform hover:scale-[1.01] disabled:opacity-50 disabled:cursor-not-allowed">
                    é–‹å§‹æ—‹è½‰ï¼
                </button>

                <!-- é¸é …ç®¡ç†å€ -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-xl border border-gray-700">
                    <h2 class="text-2xl font-bold mb-4 text-white">ç®¡ç†ä½ çš„åˆé¤é¸é …</h2>
                    
                    <!-- æ–°å¢é¸é …è¼¸å…¥ -->
                    <div class="flex space-x-2 mb-4">
                        <input type="text" id="new-option-input" placeholder="ä¾‹å¦‚ï¼šæ—¥å¼æ‹‰éºµ" class="flex-grow px-4 py-2 rounded-lg bg-gray-900 border border-gray-600 text-white focus:ring-teal-500 focus:border-teal-500">
                        <button id="add-option-button" class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-500 transition duration-150 transform hover:scale-105">æ–°å¢</button>
                    </div>

                    <!-- é¸é …åˆ—è¡¨ -->
                    <div id="options-list" class="space-y-2 max-h-48 overflow-y-auto pr-2">
                        <!-- é¸é …å°‡æœƒè¢« JavaScript æ¸²æŸ“åœ¨é€™è£¡ -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // DOM å…ƒç´ 
        const canvas = document.getElementById('roulette-wheel');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spin-button');
        const resultDisplay = document.getElementById('result-display');
        const newOptionInput = document.getElementById('new-option-input');
        const addOptionButton = document.getElementById('add-option-button');
        const optionsList = document.getElementById('options-list');
        const messageBox = document.getElementById('message-box');

        // è½‰ç›¤ç‹€æ…‹
        let options = [
            "æ—¥å¼æ–™ç†", "ç¾©å¤§åˆ©éºµ", "æ¸…çˆ½æ²™æ‹‰", "ç‰›è‚‰éºµ", "è‡ªåŠ©é¤", "é€Ÿé£Ÿåº—"
        ];
        let spinning = false;
        let startAngle = 0; // è¿½è¹¤è½‰ç›¤çš„èµ·å§‹è§’åº¦ï¼Œç¢ºä¿å‹•ç•«é€£çºŒ
        const arc = Math.PI / (options.length / 2); // æ¯å€‹é¸é …çš„è§’åº¦ (å¼§åº¦)

        // é¡è‰²åˆ—è¡¨
        const colorPalette = [
            '#ef4444', // red-500
            '#f97316', // orange-500
            '#eab308', // yellow-500
            '#22c55e', // green-500
            '#06b6d4', // cyan-500
            '#3b82f6', // blue-500
            '#8b5cf6', // violet-500
            '#ec4899', // pink-500
        ];

        // è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºè¨Šæ¯
        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.classList.remove('hidden', 'bg-red-800', 'bg-green-700');
            if (isError) {
                messageBox.classList.add('bg-red-800', 'text-red-200');
            } else {
                messageBox.classList.add('bg-green-700', 'text-white');
            }
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        }

        // 1. ç¹ªè£½è½‰ç›¤
        function drawRouletteWheel() {
            if (options.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // åœ¨æ²’æœ‰é¸é …æ™‚é¡¯ç¤ºæç¤º
                ctx.fillStyle = '#4b5563'; // gray-600
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#e5e7eb'; // gray-200
                ctx.font = '20px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('è«‹æ–°å¢é¸é …', canvas.width / 2, canvas.height / 2);
                return;
            }

            // æ›´æ–°æ¯å€‹é¸é …çš„è§’åº¦
            const currentArc = Math.PI * 2 / options.length;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = centerX;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < options.length; i++) {
                const angle = startAngle + i * currentArc;

                // ç¹ªè£½æ‰‡å½¢
                ctx.fillStyle = colorPalette[i % colorPalette.length];
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, angle, angle + currentArc, false);
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                // ç¹ªè£½æ–‡å­—
                ctx.save();
                ctx.fillStyle = '#1a1a2e'; // æ·±è‰²æ–‡å­—ï¼Œç¢ºä¿å°æ¯”åº¦
                ctx.font = 'bold 16px Inter';
                ctx.textAlign = 'center';
                ctx.translate(centerX, centerY); // ç§»å‹•åŸé»åˆ°ä¸­å¿ƒ
                ctx.rotate(angle + currentArc / 2); // æ—‹è½‰åˆ°æ‰‡å½¢ä¸­é–“
                // è¨ˆç®—æ–‡å­—ä½ç½® (è·é›¢ä¸­å¿ƒåŠå¾‘çš„ 70%)
                ctx.fillText(options[i], radius * 0.7, 0); 
                ctx.restore();
            }

            // ç¹ªè£½ä¸­å¿ƒåœ“
            ctx.beginPath();
            ctx.arc(centerX, centerY, 15, 0, Math.PI * 2, true);
            ctx.fillStyle = '#1f2937'; // gray-800
            ctx.fill();
        }

        // 2. æ—‹è½‰é‚è¼¯
        function spin() {
            if (spinning || options.length < 2) {
                showMessage(options.length < 2 ? 'è«‹è‡³å°‘æ–°å¢ 2 å€‹é¸é …æ‰èƒ½é–‹å§‹æ—‹è½‰ï¼' : 'è½‰ç›¤æ­£åœ¨æ—‹è½‰ä¸­...', true);
                return;
            }

            spinning = true;
            spinButton.disabled = true;
            resultDisplay.textContent = 'æ±ºå®šä¸­...';

            const numOptions = options.length;
            const currentArc = Math.PI * 2 / numOptions;
            
            // è¨ˆç®—éš¨æ©Ÿåœæ­¢è§’åº¦ (å¼§åº¦)
            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹ç²å‹ç´¢å¼•
            const winningIndex = Math.floor(Math.random() * numOptions);
            
            // ç²å‹æ‰‡å½¢çš„ä¸­é–“è§’åº¦ (ç›¸å°æ–¼è½‰ç›¤é ‚éƒ¨ï¼Œ0åº¦ç‚ºæŒ‡é‡ä½ç½®)
            // ç”±æ–¼æŒ‡é‡åœ¨é ‚éƒ¨ï¼Œè§’åº¦è¨ˆç®—éœ€è¦è€ƒæ…®åç§»
            // è½‰ç›¤çš„ 0 åº¦æ˜¯å³å´ï¼ŒæŒ‡é‡æ˜¯é ‚éƒ¨ (90åº¦æˆ– PI/2 å¼§åº¦)
            const angleForWinnerCenter = winningIndex * currentArc + currentArc / 2;
            
            // ç‚ºäº†è®“æŒ‡é‡æŒ‡å‘ä¸­å¿ƒï¼Œæˆ‘å€‘éœ€è¦è®“ winningIndex çš„ä¸­å¿ƒé»æ—‹è½‰åˆ° PI/2 ä½ç½®
            // éš¨æ©Ÿåœæ­¢è§’åº¦ = é¡å¤–çš„åœˆæ•¸ + è®“ä¸­ç·šå°æº–æŒ‡é‡çš„è§’åº¦
            // totalRotation = N * 360 - (angleForWinnerCenterInDegrees + 90) % 360
            
            // å°‡å¼§åº¦è½‰ç‚ºåº¦æ•¸
            const angleForWinnerCenterDeg = angleForWinnerCenter * 180 / Math.PI;
            
            // è¨ˆç®—éœ€è¦æ—‹è½‰å¤šå°‘åº¦æ‰èƒ½è®“ winningIndex å°æº–æŒ‡é‡ (æŒ‡é‡åœ¨é ‚éƒ¨ï¼Œå³ 270 åº¦ä½ç½®)
            // è®“ç²å‹æ‰‡å½¢çš„ä¸­å¿ƒé»è½åœ¨ 270 åº¦ä½ç½® (canvas åæ¨™ç³»: 0=å³, 90=ä¸‹, 180=å·¦, 270=ä¸Š)
            const targetOffsetAngle = 270 - angleForWinnerCenterDeg;

            // ç¢ºä¿æ—‹è½‰å¤šåœˆ (ä¾‹å¦‚ 5 åœˆä»¥ä¸Š)
            const extraSpins = 5;
            const totalRotationDeg = (extraSpins * 360) + targetOffsetAngle;
            
            // å°‡æ–°çš„æ—‹è½‰è§’åº¦æ‡‰ç”¨åˆ° CSS è®Šå½¢ä¸Š
            // é€™è£¡ä½¿ç”¨ `startAngle` ä¾†è¨˜éŒ„ä¸Šæ¬¡çš„åœæ­¢ä½ç½®ï¼Œä¿è­‰é€£çºŒæ€§
            // æ³¨æ„ï¼šCanvas çš„ç¹ªåœ–è§’åº¦å’Œ CSS æ—‹è½‰æ–¹å‘å¯èƒ½ä¸åŒï¼Œé€™è£¡å‡è¨­é †æ™‚é‡
            const newRotation = startAngle + totalRotationDeg;
            
            canvas.style.transform = `rotate(${newRotation}deg)`;
            
            // æ›´æ–° startAngle ä»¥ä¾›ä¸‹æ¬¡æ—‹è½‰ä½¿ç”¨
            startAngle = newRotation % 360; // è¨˜éŒ„æ–°çš„èµ·å§‹è§’åº¦ (0-360)
            
            // 3. ç¢ºå®šçµæœ (åœ¨å‹•ç•«çµæŸå¾Œ)
            canvas.addEventListener('transitionend', function onTransitionEnd() {
                canvas.removeEventListener('transitionend', onTransitionEnd);

                spinning = false;
                spinButton.disabled = false;
                
                // é¡¯ç¤ºçµæœ
                const winner = options[winningIndex];
                resultDisplay.textContent = winner;
                resultDisplay.classList.remove('text-orange-400');
                resultDisplay.classList.add('text-teal-400', 'animate-pulse');
                
                // ç§»é™¤è„ˆè¡å‹•ç•«
                setTimeout(() => {
                    resultDisplay.classList.remove('animate-pulse');
                }, 1000);

                // ç‚ºäº†ä¸‹æ¬¡ç¹ªè£½çš„æº–ç¢ºæ€§ï¼Œé›–ç„¶ CSS æ—‹è½‰äº†ï¼Œä½† Canvas ç¹ªè£½çš„ç›¸å°ä½ç½®æ²’è®Š
                // é€™è£¡ä¸éœ€è¦é‡æ–°ç¹ªè£½ï¼Œå› ç‚º CSS è™•ç†äº†æ—‹è½‰ã€‚
                // å¦‚æœä½¿ç”¨ requestAnimationFrame å‰‡éœ€è¦é€£çºŒæ›´æ–° drawRouletteWheel
                // é€™è£¡ä¿æŒ drawRouletteWheel ä¸è®Šï¼Œåªåœ¨é¸é …è®Šå‹•æ™‚æ‰ç¹ªè£½ã€‚
            });
        }
        
        // 4. ç®¡ç†é¸é … (æ–°å¢)
        function addOption() {
            const newOption = newOptionInput.value.trim();
            if (newOption && options.length < 12) { // é™åˆ¶æœ€å¤š 12 å€‹é¸é …ä»¥ç¢ºä¿å¯è®€æ€§
                options.push(newOption);
                newOptionInput.value = '';
                renderOptionsList();
                drawRouletteWheel();
                showMessage(`å·²æ–°å¢é¸é …: ${newOption}`);
            } else if (options.length >= 12) {
                showMessage('é¸é …æ•¸é‡éå¤šï¼Œè«‹ä¿æŒåœ¨ 12 å€‹ä»¥å…§ã€‚', true);
            }
        }

        // 5. ç®¡ç†é¸é … (åˆªé™¤)
        function deleteOption(index) {
            const deletedOption = options.splice(index, 1)[0];
            renderOptionsList();
            drawRouletteWheel();
            showMessage(`å·²ç§»é™¤é¸é …: ${deletedOption}`);
        }

        // 6. æ¸²æŸ“é¸é …åˆ—è¡¨
        function renderOptionsList() {
            optionsList.innerHTML = '';
            options.forEach((option, index) => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center p-2 bg-gray-700 rounded-lg shadow-md';
                item.innerHTML = `
                    <span class="text-gray-200">${option}</span>
                    <button data-index="${index}" class="delete-btn text-sm px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded-full transition duration-150">
                        ç§»é™¤
                    </button>
                `;
                optionsList.appendChild(item);
            });

            // ç‚ºæ‰€æœ‰æ–°çš„ã€Œç§»é™¤ã€æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    deleteOption(index);
                });
            });
        }
        
        // 7. äº‹ä»¶ç›£è½å™¨
        spinButton.addEventListener('click', spin);
        addOptionButton.addEventListener('click', addOption);
        newOptionInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addOption();
            }
        });

        // åˆå§‹åŒ–
        window.onload = function() {
            // ç¢ºä¿ canvas æ—‹è½‰æ­¸é›¶
            canvas.style.transform = `rotate(${startAngle}deg)`;
            renderOptionsList();
            drawRouletteWheel();
        };

    </script>
</body>
</html>
